{% assign categories_max = 0 %}
{% for category in site.categories %}
  {% if category[1].size > categories_max %}
    {% assign categories_max = category[1].size %}
  {% endif %}
{% endfor %}

<div class="side-menu" aria-hidden="true">
  <nav class="menu__layer" id="primary-nav" aria-labelledby="nav-title" itemscope itemtype="https://schema.org/SiteNavigationElement">
    <h2 id="nav-title">{{ site.data.ui-text[site.locale].menu_primary_links | default: 'Primary links' }}</h2>
    <ul class="menu__list--grid" role="menu">
      {%- for link in site.data.navigation.main -%}
      {%- if link.url contains '://' -%}
        {%- assign url = link.url -%}
      {%- else -%}
        {%- assign url = link.url | relative_url -%}
      {%- endif -%}
      <li role="menuitem">
        <a href="{{ url }}" {% if link.description %}title="{{ link.description }}" {% endif %} itemprop="url">{{ link.title }}</a>
      </li>
      {%- endfor -%}
    </ul>
  
    {% if site.categories.size > 0 %}
    <h2>{{ site.data.ui-text[site.locale].menu_categories | default: 'Categories' }}</h2>
    {% endif %}
    <ul>
      {% for i in (1..categories_max) reversed %}
      {% for category in site.categories limit: 8 %}
      {% if category[1].size == i %}
      <li>
        <a href="/category-list/#{{ category[0] }}">{{ category[0] }}</a>
        {% if site.main_nav.menu_list_count %}<small class="menu__list-count">({{ category[1].size }})</small>{% endif %}
      </li>
      {% endif %}
      {% endfor %}
      {% endfor %}
    </ul>

    <a href="/category-list/" class="menu__btn--more">
      <span class="visually-hidden">{{ site.data.ui-text[site.locale].main_nav_category_more }}</span>
    </a>

    {% if site.theme_type == "type2" %}{% include author_link.html %}{% endif %}
    
    <button type="button" class="menu__btn--close" aria-controls="primary-nav">
      <span class="visually-hidden">{{ site.data.ui-text[site.locale].menu_close_label }}</span>
      <span class="ico" aria-hidden="true"></span>
    </button>
  </nav>
</div>